<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Elpriser JSON</title>
</head>
<body>
<script>
async function hentData() {

  // Start: nu rundet til nÃ¦rmeste hele time
  const now = new Date();
  now.setMinutes(0,0,0);

  // Slut: 36 timer frem
  const end = new Date(now.getTime() + 36 * 60 * 60 * 1000);

  function fmt(d) {
    return d.toISOString().slice(0,16);
  }

  const url =
    `https://api.energidataservice.dk/dataset/DayAheadPrices` +
    `?start=${fmt(now)}&end=${fmt(end)}` +
    `&filter=${encodeURIComponent('{"PriceArea":["DK1","DK2"]}')}` +
    `&limit=500`;

  const res = await fetch(url);
  const json = await res.json();

  const times = {};

  json.records.forEach(r => {
    const d = new Date(r.TimeDK);
    d.setMinutes(0,0,0);
    const hourKey = d.toISOString().slice(0,13)+":00";

    if (!times[hourKey]) times[hourKey] = { DK1: [], DK2: [] };
    times[hourKey][r.PriceArea].push(r.DayAheadPriceDKK);
  });

  const output = [];
  Object.keys(times).sort().forEach(hour => {
    const j = times[hour].DK1;
    const s = times[hour].DK2;

    output.push({
      time: hour,
      jylland_fyn: j.reduce((a,b)=>a+b,0)/j.length,
      sjaelland_oerne: s.reduce((a,b)=>a+b,0)/s.length
    });
  });

  document.body.innerText = JSON.stringify(output, null, 2);
}

hentData();
</script>
</body>
</html>
